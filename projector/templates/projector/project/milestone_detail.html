{% extends "projector/project/details.html" %}

{% load markup %}
{% load i18n %}
{% load permissions %}

{% block col_main_title %}{{ project.name }}{% endblock %}

{% block col_main_extra %}
<div class="richtemplates-panel">    
    <h5>{% trans "Milestone detail" %}</h5>
    <div class="richtemplates-panel-content">
        <ul class="nav-inline">
            <li><a class="button-link" href="{{ milestone.get_edit_url }}">{% trans "Edit" %}</a></li>
            <li><a class="button-link" href="{{ milestone.get_tasks_url }}">{% trans "Show tasks" %}</a></li>
        </ul>
        <div class="task-block">
            <table class="task-block-properties">
                <tbody>
                    <tr>
                        <th>{% trans "Name" %}</th>
                        <td>{{ milestone.name }}</td>
                    </tr>
                    <tr>
                        <th>{% trans "Description" %}</th>
                        <td>{{ milestone.description|safe|restructuredtext }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        {% if milestone.task_set.all %}
        <table class="projetor-milestone-progress-table">
            <tbody>
                <tr>
                    {% with milestone.get_finished_tasks_count_as_percentage as finished %}
                    {% if finished %}
                        <td class="projector-milestone-progress-table-finished"
                            width="{{ milestone.get_finished_tasks_count_as_percentage }}%">
                            <a class="block-link"
                                href="{{ project.get_task_list_url }}?is_resolved=2&milestone={{ milestone.id }}">
                            {% trans "Done" %} {{ finished|floatformat:"2" }} &#37;</a>
                        </td>
                    {% endif %}
                    {% endwith %}
                    {% with milestone.get_unfinished_tasks_count_as_percentage as unfinished %}
                    {% if unfinished %}
                    <td class="projector-milestone-progress-table-unfinished">
                        <a class="block-link" href="{{ project.get_task_list_url }}?is_resolved=3&milestone={{ milestone.id }}">
                            {% trans "Left" %} {{ unfinished|floatformat:"2" }} &#37;</a>
                    </td>
                    {% endif %}
                    {% endwith %}
                </tr>
            </tbody>
        </table>
        {% else %}
            <ul class="messages">
                <li class="message message-info">{% trans "No tasks for this milestone were found" %}</li>
            </ul>
        {% endif %}

    </div>
</div>
{% endblock col_main_extra %}

