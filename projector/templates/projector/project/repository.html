{% extends "projector/project/details.html" %}

{% load i18n %}
{% load richtemplates_tags %}
{% load native %}

{% if root.is_file %}
    {% block head_css %}{{ block.super }}
    {% endblock %}
{% endif %}

{% block col_main_extra %}

<div class="richtemplates-panel">
    <h5>{% trans "Project's repository browser" %}</h5>
    <div class="richtemplates-panel-content">
    <ul class="nav-inline">
        <li><a class="button-link" href="{{ project.get_browse_repo_url }}">{% trans "Sources" %}</a></li>
        <li><a class="button-link" href="{{ project.get_changesets_url }}">{% trans "Changesets" %}</a></li>
    </ul>    
    <div id="repo-browser">
        {% load breadcrumber %}
        <div class="browser-breadcrumbs">
            {% path_breadcrumbs request.META.PATH_INFO 3 %}
        </div>
        
        {% if root.is_dir %}
        <table class="code-browser">
            <thead>
                <tr>
                    <th class="width-50 lefted">{% trans "Name" %}</th>
                    <th class="width-10 righted">{% trans "Size" %}</th>
                    <th class="width-10 righted">{% trans "Revision" %}</th>
                    <th class="width-15 righted">{% trans "Last modified" %}</th>
                    <th class="width-15 righted">{% trans "Last committer" %}</th>
                </tr>
            </thead>
            <tbody>

                {% if root.parent %}
                <tr class="even hoverable">
                    <td>
                        <a class="browser-dir"
                            href="{% url projector_project_browse_repository project.slug root.parent.path %}">..</a>
                    </td>
                    <td class="righted"></td>
                    <td class="righted width-10"></td>
                    <td class="righted width-10">
                    </td>
                    <td class="righted width-10"></td>
                </tr>
                {% endif %}

                {% for node in root.nodes %}
                <tr class="{% cycle "odd" "even" %} hoverable">
                    <td>
                        <a class="{% if node.is_dir %}browser-dir{% else %}browser-file{% endif %}"
                            href="{% url projector_project_browse_repository project.slug node.path %}"
                            >{{ node.name }}</a>
                    </td>
                    {% if node.is_dir %}
                    <td></td><td></td><td></td><td></td>
                    {% else %}
                    <td class="righted">{% if node.is_file %}{{ node.size|filesizeformat }}{% endif %}</td>
                    <td class="righted">{{ node.last_changeset.revision }}</td>
                    <td class="righted">
                        <span class="show-tooltip"
                            title="{{ node.last_changeset.date|date:"Y-m-d" }} {{ node.last_changeset.date|date:"H:i:s" }}">
                        {{ node.last_changeset.date|timesince }} ago
                        </span>
                    </td>
                    <td class="righted">{{ node.last_changeset.author|tooltip:"20" }}</td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
        {% if root.is_file %}
        <div class="codeblock">
            {% highlight root.content root.lexer_alias linenos=true cssclass="code-highlight" %}
        </div>
        {% endif %}
    </div>
</div>
</div>

{% endblock %}
